<!--
title: Apache Kafka
description: 
published: true
date: 2025-03-22T11:34:32.089Z
tags: 
editor: ckeditor
dateCreated: 2025-03-22T11:34:32.089Z
-->

<h1>–ì–∞–π–¥ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é Apache Kafka –≤ C#</h1>
<h2>–í–≤–µ–¥–µ–Ω–∏–µ –≤ Apache Kafka</h2>
<h3>–ß—Ç–æ —Ç–∞–∫–æ–µ Apache Kafka?</h3>
<p>Apache Kafka ‚Äî —ç—Ç–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–∞—è –¥–ª—è –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –º–µ–∂–¥—É —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏. Kafka –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–±–æ—Ä–∞, –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø–µ—Ä–µ–¥–∞—á–∏ —Å–æ–±—ã—Ç–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.</p>
<h3>–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ Kafka:</h3>
<p><strong>Producer (–ü—Ä–æ–¥—é—Å–µ—Ä)</strong> ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Kafka.</p>
<p><strong>Consumer (–ö–æ–Ω—Å—å—é–º–µ—Ä)</strong> ‚Äî –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ Kafka.</p>
<p><strong>Topic (–¢–æ–ø–∏–∫)</strong> ‚Äî –ª–æ–≥–∏—á–µ—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π.</p>
<p><strong>Partition (–†–∞–∑–¥–µ–ª)</strong> ‚Äî –ø–æ–¥–≥—Ä—É–ø–ø–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤–Ω—É—Ç—Ä–∏ —Ç–æ–ø–∏–∫–∞.</p>
<p><strong>Broker (–ë—Ä–æ–∫–µ—Ä)</strong> ‚Äî —Å–µ—Ä–≤–µ—Ä Kafka, —É–ø—Ä–∞–≤–ª—è—é—â–∏–π —Ç–æ–ø–∏–∫–∞–º–∏ –∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏.</p>
<p><strong>Zookeeper</strong> ‚Äî —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ Kafka –∏ –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –±—Ä–æ–∫–µ—Ä—ã.</p>
<p><strong>Consumer Group (–ì—Ä—É–ø–ø–∞ –ö–æ–Ω—Å—å—é–º–µ—Ä–æ–≤)</strong> ‚Äî –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–Ω—Å—å—é–º–µ—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.</p>
<h2>–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ Apache Kafka</h2>
<h3>–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å</h3>
<p>Kafka –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –ø—É—Ç–µ–º —É–≤–µ–ª–∏—á–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±—Ä–æ–∫–µ—Ä–æ–≤, –ø–∞—Ä—Ç–∏—Ü–∏–π –∏ –∫–æ–Ω—Å—å—é–º–µ—Ä–æ–≤, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É –Ω–∞–≥—Ä—É–∑–∫–∏.</p>
<h3>–í—ã—Å–æ–∫–∞—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å</h3>
<p>–ë–ª–∞–≥–æ–¥–∞—Ä—è –º–µ—Ö–∞–Ω–∏–∑–º—É —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏, –¥–∞–Ω–Ω—ã–µ –≤ Kafka –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –º–µ–∂–¥—É –±—Ä–æ–∫–µ—Ä–∞–º–∏, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π –¥–∞–∂–µ –ø—Ä–∏ –æ—Ç–∫–∞–∑–µ —É–∑–ª–∞.</p>
<h3>–û—á–µ—Ä–µ–¥—å —Å–æ–æ–±—â–µ–Ω–∏–π –∏ Pub/Sub</h3>
<p>Kafka –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞–∫ –º–æ–¥–µ–ª—å –æ—á–µ—Ä–µ–¥–∏ —Å–æ–æ–±—â–µ–Ω–∏–π (–≥–¥–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –º–µ–∂–¥—É –∫–æ–Ω—Å—å—é–º–µ—Ä–∞–º–∏), —Ç–∞–∫ –∏ –º–æ–¥–µ–ª—å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏-–ø–æ–¥–ø–∏—Å–∫–∏ (–≥–¥–µ –≤—Å–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ –ø–æ–ª—É—á–∞—é—Ç —Å–æ–æ–±—â–µ–Ω–∏—è).</p>
<h3>–ì–∏–±–∫–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö</h3>
<p>–°–æ–æ–±—â–µ–Ω–∏—è –≤ Kafka —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ –≤—Ä–µ–º–µ–Ω–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 7 –¥–Ω–µ–π), —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π.</p>
<h3>–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ—Ç–æ–∫–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏</h3>
<p>Kafka –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å —Ç–∞–∫–∏–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏, –∫–∞–∫ Kafka Streams –∏ Apache Flink, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.</p>
<h2>–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Kafka</h2>
<h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±—Ä–æ–∫–µ—Ä–æ–≤</h3>
<p><code>log.retention.hours</code> ‚Äî –≤—Ä–µ–º—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Å–∞—Ö.</p>
<p><code>log.segment.bytes</code> ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Å–µ–≥–º–µ–Ω—Ç–∞ –ª–æ–≥–æ–≤.</p>
<p><code>num.partitions</code> ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä—Ç–∏—Ü–∏–π –¥–ª—è —Ç–æ–ø–∏–∫–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.</p>
<p><code>default.replication.factor</code> ‚Äî —É—Ä–æ–≤–µ–Ω—å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π.</p>
<h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–¥—é—Å–µ—Ä–∞</h3>
<p><code>acks</code> ‚Äî —É—Ä–æ–≤–µ–Ω—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ (<code>0</code>, <code>1</code>, <code>all</code>).</p>
<p><code>retries</code> ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π.</p>
<p><code>linger.ms</code> ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –ø–∞–∫–µ—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏–π.</p>
<p><code>batch.size</code> ‚Äî —Ä–∞–∑–º–µ—Ä –ø–∞–∫–µ—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏–π.</p>
<h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω—Å—å—é–º–µ—Ä–∞</h3>
<p><code>group.id</code> ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≥—Ä—É–ø–ø—ã –∫–æ–Ω—Å—å—é–º–µ—Ä–æ–≤.</p>
<p><code>auto.offset.reset</code> ‚Äî –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –æ—Ñ—Ñ—Å–µ—Ç–∞ (<code>earliest</code>, <code>latest</code>).</p>
<p><code>enable.auto.commit</code> ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π.</p>
<h2>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Apache Kafka</h2>
<h3>–ó–∞–ø—É—Å–∫ Kafka –≤ Docker</h3>
<p>–ß—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å Kafka –≤ Docker, –∏—Å–ø–æ–ª—å–∑—É–µ–º <code>docker-compose</code>.</p>
<p>–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª <code>docker-compose.yml</code>:</p>
<pre><code class="language-plaintext">version: '3.7'
services:
  zookeeper:
    image: confluentinc/cp-zookeeper:latest
    restart: always
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181
  kafka:
    image: confluentinc/cp-kafka:latest
    restart: always
    depends_on:
      - zookeeper
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://localhost:9092
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
    ports:
      - "9092:9092"</code></pre>
<p>–ó–∞–ø—É—Å—Ç–∏—Ç–µ Kafka:</p>
<pre><code class="language-plaintext">    docker-compose up -d</code></pre>
<h3>–ó–∞–ø—É—Å–∫ Kafka –≤—Ä—É—á–Ω—É—é</h3>
<p><strong>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Zookeeper –∏ Kafka</strong> (–µ—Å–ª–∏ —É –≤–∞—Å –∏—Ö –Ω–µ—Ç):</p>
<pre><code class="language-plaintext">wget https://downloads.apache.org/kafka/3.5.1/kafka_2.13-3.5.1.tgz
tar -xvzf kafka_2.13-3.5.1.tgz
cd kafka_2.13-3.5.1</code></pre>
<p><strong>–ó–∞–ø—É—Å—Ç–∏—Ç–µ Zookeeper:</strong></p>
<pre><code class="language-plaintext">bin/zookeeper-server-start.sh config/zookeeper.properties</code></pre>
<p><strong>–ó–∞–ø—É—Å—Ç–∏—Ç–µ Kafka:</strong></p>
<pre><code class="language-plaintext">bin/kafka-server-start.sh config/server.properties</code></pre>
<h2>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Kafka –¥–ª—è C#</h2>
<p>Apache Kafka –Ω–µ –∏–º–µ–µ—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è C#, –Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ <code>Confluent.Kafka</code>:</p>
<pre><code class="language-plaintext">    dotnet add package Confluent.Kafka</code></pre>
<h2>–°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–∞</h2>
<p>–°–æ–∑–¥–∞–¥–∏–º —Ç–æ–ø–∏–∫ <code>test-topic</code>:</p>
<pre><code class="language-plaintext">    bin/kafka-topics.sh --create --topic test-topic --bootstrap-server localhost:9092 --partitions 1 --replication-factor 1</code></pre>
<h2>–ü—Ä–æ–¥—é—Å–µ—Ä (Producer) –≤ C#</h2>
<p>–°–æ–∑–¥–∞–¥–∏–º –ø—Ä–æ–¥—é—Å–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Kafka:</p>
<pre><code class="language-plaintext">using System;
using System.Threading.Tasks;
using Confluent.Kafka;

class Program
{
    static async Task Main()
    {
        var config = new ProducerConfig { BootstrapServers = "localhost:9092" };
        using var producer = new ProducerBuilder&lt;Null, string&gt;(config).Build();
        
        for (int i = 0; i &lt; 10; i++)
        {
            var message = $"Message {i}";
            var deliveryResult = await producer.ProduceAsync("test-topic", new Message&lt;Null, string&gt; { Value = message });
            Console.WriteLine($"Sent: {message} to {deliveryResult.TopicPartitionOffset}");
        }
    }
}</code></pre>
<h2>–ö–æ–Ω—Å—å—é–º–µ—Ä (Consumer) –≤ C#</h2>
<p>–°–æ–∑–¥–∞–¥–∏–º –∫–æ–Ω—Å—å—é–º–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ Kafka:</p>
<pre><code class="language-plaintext">using System;
using System.Threading;
using Confluent.Kafka;

class Program
{
    static void Main()
    {
        var config = new ConsumerConfig
        {
            BootstrapServers = "localhost:9092",
            GroupId = "test-group",
            AutoOffsetReset = AutoOffsetReset.Earliest
        };

        using var consumer = new ConsumerBuilder&lt;Ignore, string&gt;(config).Build();
        consumer.Subscribe("test-topic");

        CancellationTokenSource cts = new CancellationTokenSource();
        Console.CancelKeyPress += (_, e) =&gt; { e.Cancel = true; cts.Cancel(); };

        try
        {
            while (true)
            {
                try
                {
                    var consumeResult = consumer.Consume(cts.Token);
                    Console.WriteLine($"Received: {consumeResult.Value}");
                }
                catch (ConsumeException e)
                {
                    Console.WriteLine($"Error: {e.Error.Reason}");
                }
            }
        }
        catch (OperationCanceledException)
        {
            consumer.Close();
        }
    }
}</code></pre>
<h2>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã</h2>
<p><strong>–ó–∞–ø—É—Å—Ç–∏—Ç–µ Kafka –∏ —Å–æ–∑–¥–∞–π—Ç–µ —Ç–æ–ø–∏–∫.</strong></p>
<p><strong>–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Å—é–º–µ—Ä</strong> (–æ–Ω –Ω–∞—á–Ω—ë—Ç –æ–∂–∏–¥–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è).</p>
<p><strong>–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–¥—é—Å–µ—Ä</strong>, –∏ –æ–Ω –æ—Ç–ø—Ä–∞–≤–∏—Ç 10 —Å–æ–æ–±—â–µ–Ω–∏–π.</p>
<p><strong>–ö–æ–Ω—Å—å—é–º–µ—Ä –≤—ã–≤–µ–¥–µ—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–æ–Ω—Å–æ–ª—å.</strong></p>
<p>–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å —Ä–∞–±–æ—á–∏–π Kafka-–ø—Ä–æ–¥—é—Å–µ—Ä –∏ –∫–æ–Ω—Å—å—é–º–µ—Ä –Ω–∞ C#! üöÄ</p>
